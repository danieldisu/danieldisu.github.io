<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>danieldisu.com</title>
  <meta name="description" content="tech related thoughts" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
  <script type="text/javascript" src="/js/highlight.pack.js"></script>
  <link rel="stylesheet" type="text/css" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
  <meta name="generator" content="danieldisu.com">

  
  
  

  
</head>


<body class="home-template">

  <header class="site-head">
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/yo.jpg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">danieldisu.com</h1>
            <h2 class="blog-description">tech related thoughts</h2>
        </div>
    </div>
</header>
  
<main class="content" role="main">
  
    <div class="post-container ">
  <article class="post">
    <header class="post-header">
      <span class="post-meta">
      <time datetime="2015-03-07T18:02:00.000Z" itemprop="datePublished">
          2015-03-07
      </time>
      <author> by danieldisu</author>
    
</span>

      <h1 class="post-title"><a href="/2015/03/07/Typescript/">Typescript</a></h1>
    </header>
    <section class="post-content">
      <p>
        <h1 id="Introducción">Introducción</h1><p>Desarrollar aplicaciones en Javascript puede convertirse en todo un desafío una vez que empieza a crecer tanto la aplicación como el equipo, originalmente se pensó como un lenguaje para hacer efectos sencillos en la páginas estáticas, y estamos intentándolo usar para hacer aplicaciones mucho más complejas de lo que se pensó originalmente posible.</p>
<p>Aunque Javascript está avanzando a pasos agigantados, la compatibilidad con navegadores antiguos es todavía un problema, por ello la gente de Microsoft creó Typescript, un lenguaje Open Source basado en Javascript y que se integra perfectamente con otro código Javascript, solucionando algunos de los principales problemas que tiene Javascript:</p>
<ul>
<li>Falta de tipado fuerte y estático.</li>
<li>Falta de <a href="http://en.wikipedia.org/wiki/Syntactic_sugar" target="_blank" rel="external">“Syntactic Sugar”</a> para la creación de clases</li>
<li>Falta de interfaces (aumenta el acoplamiento ya que obliga a programar hacia la implementación)</li>
<li>Módulos (parcialmente resuelto con require.js, aunque está lejos de ser perfecto)</li>
</ul>
<p>Typescript es un lenguaje con una sintaxis bastante parecida a la de C# y Java, por lo que hace fácil para los desarrolladores con experiencia en estos lenguajes el aprender Typescript.</p>
<p>Otra ventaja del tipado estático es que habilita a otras herramientas a mejorar el soporte y la detección de errores sin necesidad de arrancar el código, además de servir cómo documentación al programador.</p>
<h1 id="Sintaxis">Sintaxis</h1><h2 id="Tipos_básicos">Tipos básicos</h2><p>Los tipos básicos que maneja Typescript son <code>booleans</code>, <code>number</code>, <code>string</code>, <code>Any</code> y <code>Void</code>.</p>
<pre><code><span class="keyword">var</span> isDone: boolean = <span class="literal">false</span>;
<span class="keyword">var</span> height: number = <span class="number">6</span>;
<span class="keyword">var</span> name: string = <span class="string">"bob"</span>;
<span class="keyword">var</span> list:number[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];
<span class="keyword">var</span> notSure: any = <span class="number">4</span>;
<span class="function"><span class="keyword">function</span> <span class="title">warnUser</span><span class="params">()</span><span class="type">: void</span> </span>{
    alert(<span class="string">"This is my warning message"</span>);
}
</code></pre><p>Los cuatro primeros tipos no hace falta explicarlos ya que cualquier desarrollador estará bastante familiarizado con ellos, el 5º tipo <code>Any</code> es un tipo dinámico, se utiliza principalmente cuando no queremos declarar el tipo o cuando estamos declarando el tipo de una librería de terceros, también se usa en arrays que contienen distintos tipos.</p>
<p>Por último, <code>void</code> se utiliza principalmente para declarar el tipo de funciones que no devuelven nada, cómo en el ejemplo de arriba.</p>
<h2 id="Clases_e_interfaces">Clases e interfaces</h2><pre><code><span class="interface"><span class="keyword">interface</span> Animal </span>{
  name : <span class="built_in">string</span>;
  makeSound();
}


<span class="keyword">class</span> Dog <span class="keyword">implements</span> Animal {
  <span class="constructor"><span class="keyword">constructor</span>(name:string) </span>{
    <span class="keyword">this</span>.name = name;
  }

  name:<span class="built_in">string</span>;

  makeSound() {
    <span class="keyword">return</span> <span class="string">"guau!"</span>;
  }
}

<span class="function"><span class="keyword">function</span> <span class="title">sayHi</span><span class="params">(animal:Animal)</span> </span>{
  <span class="built_in">console</span>.log(<span class="string">"hi "</span> + animal.name);
}

sayHi(<span class="keyword">new</span> Dog(<span class="string">"Timmy"</span>))
</code></pre><p>Esto, como es de esperar devolverá <code>hi Timmy</code> por consola.</p>
<h2 id="Modulos">Modulos</h2><p>Este quizás sea uno de los puntos más necesarios a la hora de conseguir una mejor arquitectura en las aplicaciones Javascript.</p>
<p>Typescript lo resuelve usando una sintaxis parecida a la que veremos en Javascript cuando el estándar ES6 se implemente en los navegadores. Typescript tiene dos tipos de módulos internos y externos, a continuación vamos a explicar los externos, ya que queremos que se puedan usar en todos los navegadores ( para ello los compila en módulos de Require )</p>
<p>Vamos a repartir una clase / interfaz por fichero, de manera que podamos tener el código bien organizado, basándonos en el ejemplo anterior:</p>
<p><code>models/Animal.ts</code><br><code>models/Dog.ts</code><br><code>Main.ts</code></p>
<pre><code><span class="comment">//models/Animal.ts</span>
<span class="interface"><span class="keyword">interface</span> Animal </span>{
  name : <span class="built_in">string</span>;
  makeSound();
}

<span class="keyword">export</span> = Animal
</code></pre><p>Podemos ver la keyword <code>export</code> que permite que otros módulos/clases utilicen la interfaz Animal.</p>
<pre><code><span class="comment">// models/Dog.ts</span>
<span class="keyword">import</span> Animal = <span class="built_in">require</span>(<span class="string">'Animal'</span>)

<span class="keyword">class</span> Dog <span class="keyword">implements</span> Animal {
  <span class="constructor"><span class="keyword">constructor</span>(name:string) </span>{
    <span class="keyword">this</span>.name = name;
  }

  name:<span class="built_in">string</span>;

  makeSound() {
    <span class="keyword">return</span> <span class="string">"guau!"</span>;
  }
}

<span class="keyword">export</span> = Dog
</code></pre><p>En este ejemplo se ven dos keywords nuevas, <code>import</code> y <code>require</code>, tras el import nombramos a la variable que vamos a tener disponible en el resto del fichero y con require nombramos el modulo que queremos importar.</p>
<p>Por último, para usar estos módulos en nuestro fichero <code>Main.ts</code>:</p>
<pre><code><span class="keyword">import</span> Dog = <span class="built_in">require</span>(<span class="string">'models/Dog'</span>)
<span class="keyword">import</span> Animal = <span class="built_in">require</span>(<span class="string">'models/Animal'</span>)

<span class="function"><span class="keyword">function</span> <span class="title">sayHi</span><span class="params">(animal:Animal)</span> </span>{
  <span class="built_in">console</span>.log(<span class="string">"hi "</span> + animal.name);
}

sayHi(<span class="keyword">new</span> Dog(<span class="string">"Timmy"</span>))
</code></pre><p>y el resultado: <code>hi Timmy</code>.</p>
<p>Puedes ver todos los ficheros en <a href="https://github.com/danieldisu/typescript-example/tree/master/app/src" target="_blank" rel="external">Github</a></p>
<h2 id="Genéricos">Genéricos</h2><p>Los genéricos son muy útiles para hacer código mas reusable, uno de los claros ejemplos son las listas/Arrays, en el siguiente extracto podemos observar como podemos definir el tipo del Array.</p>
<pre><code><span class="keyword">var</span> animals:<span class="keyword">Array</span>&lt;Animal&gt; = [<span class="keyword">new</span> Dog(<span class="string">'Timmy'</span>), <span class="keyword">new</span> Dog(<span class="string">'Michael'</span>), <span class="keyword">new</span> Dog(<span class="string">'Dwight'</span>)];
animals.<span class="keyword">forEach</span>(sayHi);
</code></pre><p>Esto puede ayudar sobre todo a hacer librerías y piezas de código más reutilizables.</p>
<h1 id="Comunicación_con_código_Javascript_ya_existente">Comunicación con código Javascript ya existente</h1><p>Otra de las ventajas que otorga Typescript es que permite comunicarse con código Javascript ya creado e incluso añadirle “tipos” a través de unos ficheros <code>d.ts</code> que indican los tipos que reciben y devuelven las funciones de una librería por ejemplo.</p>
<p>Hay una estupenda <a href="http://definitelytyped.org/" target="_blank" rel="external">comunidad</a> con definiciones para algunas de las librerías más usadas, como pueden ser Underscore, jQuery o Backbone.</p>
<p>Con solo descargarse la definición y añadir una linea de texto en nuestro fichero, nos proporciona tipado para aquellas librerías que no han sido escritas en Typescript.</p>
<pre><code>/// <span class="tag">&lt;<span class="title">reference</span> <span class="attribute">path</span>=<span class="value">"../libs/underscore.d.ts"</span> /&gt;</span>
</code></pre><p><img src="introduccion_typescript/imagen1.png" alt="TypescriptIntellij"></p>
<p>Aquí podemos ver como IntelliJ es capaz de decirnos que tipo espera cada función.</p>
<p>En caso de que usáramos una librería interna o que no tenga declaración de tipos podemos hacerla nosotros, según fuésemos necesitando las distintas funciones.</p>
<pre><code>declare <span class="keyword">var</span> _: {
    each&lt;T, U&gt;(arr: T[], f: (elem: T) =&gt; U): U[];
    delay(f: <span class="type">Function</span>, wait: number, ...arguments: <span class="type">any</span>[]): number;
    <span class="keyword">template</span>(<span class="keyword">template</span>: <span class="type">string</span>): (model: <span class="type">any</span>) =&gt; <span class="type">string</span>;
    bindAll(<span class="keyword">object</span>: <span class="type">any</span>, ...methodNames: <span class="type">string</span>[]): <span class="type">void</span>;
};
</code></pre><p>Si por lo que fuera necesitáramos acceder desde Javascript al código generado por Typescript es muy sencillo, ya que el código generado es fácilmente legible como podremos comprobar a continuación.</p>
<h1 id="Compilador_Typescript,_Grunt_y_Gulp-">Compilador Typescript, Grunt y Gulp.</h1><p>Para que funcione todo esto hace falta un paso intermedio para convertir el código Typescript en código Javascript, para ello existen varios métodos.</p>
<h2 id="Compilador_Typescript">Compilador Typescript</h2><p>El equipo de Typescript provee una herramienta de linea de comandos para hacer esta compilación, se encuentra en npm y se puede instalar con el siguiente comando:</p>
<pre><code>npm <span class="keyword">install</span> -g typescript
</code></pre><p>Podemos usarlo escribiendo</p>
<pre><code><span class="title">tsc</span> helloworld.ts
</code></pre><p>Si queremos compilar varios ficheros, y que los módulos sean con notación AMD, podríamos hacerlo:</p>
<pre><code>tsc foo<span class="class">.ts</span> bar<span class="class">.ts</span> --module amd
</code></pre><p>Esto no escala, ya que poner todos los ficheros uno a uno en la consola, puede resultar muy incomodo, por ello podemos usar Typescript con herramientas como Grunt o Gulp, a continuación voy a poner un ejemplo de como montar la build con Gulp.</p>
<h2 id="Compilando_con_Gulp">Compilando con Gulp</h2><p>Gulp es un TaskRunner parecido a Grunt (y Maven para los que vengan del mundo Java, sin la parte de dependencias).</p>
<p>La idea es que se ejecute automáticamente el compilador Typescript cada vez que modifiquemos un fichero, y se recargue el navegador con los ficheros Javascript generados.</p>
<p>(A partir de aquí tenemos en cuenta de que tienes instalado Gulp en tu ordenador, puedes leer cómo <a href="http://gulpjs.com/" target="_blank" rel="external">aquí</a>)</p>
<pre><code><span class="tag">gulp</span><span class="class">.task</span>(<span class="string">'compile:typescript'</span>, function () {
  <span class="tag">gulp</span><span class="class">.src</span>(<span class="string">'app/src/**/*.ts'</span>)
    <span class="class">.pipe</span>(<span class="function">ts</span>({
      <span class="attribute">declarationFiles</span>: true,
      <span class="attribute">noExternalResolve</span>: true,
      <span class="attribute">module</span>: <span class="string">'amd'</span>
    }))
    <span class="class">.pipe</span>(gulp.<span class="function">dest</span>(<span class="string">'dist/scripts'</span>))
});
</code></pre><p>Esto lo que hará será compilar todos los ficheros con la extension <code>.ts</code> con las opciones que le pasemos en el objeto json dentro de <code>ts()</code> y los pondrá en <code>dist</code>.</p>
<p>Esta tarea ha de ser invocada manualmente, el siguiente paso será crear una tarea que detecte los cambios en los ficheros con extension <code>.ts</code> y ejecute automáticamente dicha tarea, para ello usaremos la función watch de gulp.</p>
<pre><code>gulp.task(<span class="symbol">'default'</span>, <span class="keyword">function</span> <span class="literal">()</span> {
  gulp.watch(<span class="symbol">'app</span>/src/**/*.ts', [<span class="symbol">'compile</span>:typescript'])
});
</code></pre><p>Por último vamos a crear una tarea que nos cree un servidor local donde probar nuestra aplicación, y que cada vez que cambiemos algún fichero se recargue el navegador.</p>
<pre><code><span class="comment">// Watch Files For Changes &amp; Reload</span>
<span class="tag">gulp</span><span class="class">.task</span>(<span class="string">'serve'</span>, [<span class="string">'compile:typescript'</span>], function () {
  <span class="tag">browserSync</span>({
    <span class="attribute">notify</span>: false,
    <span class="attribute">server</span>: [<span class="string">'dist'</span>, <span class="string">'app'</span>]
  });
  <span class="tag">gulp</span><span class="class">.watch</span>([<span class="string">'app/**/*.html'</span>], reload);
  <span class="tag">gulp</span><span class="class">.watch</span>([<span class="string">'app/src/**/*.ts'</span>], [<span class="string">'compile:typescript'</span>, reload])
});
</code></pre><p>Puedes ver el fichero entero con todos las dependencias <a href="https://github.com/danieldisu/typescript-example/blob/master/gulpfile.js" target="_blank" rel="external">aquí</a>.</p>
<h1 id="Revisando_el_código_generado">Revisando el código generado</h1><p>Por último, vamos a comprobar el código que ha generado el compilador de Typescript, el siguiente código es el que ha generado para el fichero <code>main.js</code></p>
<pre><code>define([<span class="string">"require"</span>, <span class="string">"exports"</span>, <span class="string">'models/Dog'</span>], <span class="function"><span class="keyword">function</span> <span class="params">(require, exports, Dog)</span> </span>{
    <span class="function"><span class="keyword">function</span> <span class="title">sayHi</span><span class="params">(animal)</span> </span>{
        <span class="built_in">console</span>.log(<span class="string">"hi "</span> + animal.name);
    }
    sayHi(<span class="keyword">new</span> Dog(<span class="string">"Timmy"</span>));
});
</code></pre><p>Cómo se puede observar es código fácilmente legible, y podría ser fácilmente generado por un humano, esto es una de las principales ventajas de Typescript respecto a otros lenguajes que compilan a Javascript.</p>
<p>También podemos observar como se compilan las clases:</p>
<pre><code>define([<span class="string">"require"</span>, <span class="string">"exports"</span>], <span class="function"><span class="keyword">function</span> <span class="params">(require, exports)</span> </span>{
    <span class="keyword">var</span> Dog = (<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
        <span class="function"><span class="keyword">function</span> <span class="title">Dog</span><span class="params">(name)</span> </span>{
            <span class="keyword">this</span>.name = name;
        }
        Dog.prototype.makeSound = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>{
            <span class="keyword">return</span> <span class="string">"guau!"</span>;
        };
        <span class="keyword">return</span> Dog;
    })();
    <span class="keyword">return</span> Dog;
});
</code></pre><p>Como podemos ver no se hace ningún tipo de mención a la interfaz Animal y esto es debido a que la comprobación de que cumpla la interfaz se hace en tiempo de compilación y no en tiempo de ejecución, por lo que no incurrimos en ningún tipo de penalización.</p>
<h1 id="Conclusiones">Conclusiones</h1><p>Como hemos podido ver Typescript añade algunas cosas interesantes que echamos de menos en Javascript que ayudaran a mejorar el código y a aumentar la mantenibilidad en proyectos grandes.</p>
<p>También hemos podido observar que el código generado no es “mágico” por lo que no debería dificultar el debugging o la recolección de trazas. Además de que el tipado puede ayudarnos mucho a la hora de hacer nuestro código más robusto y además nos ofrece una documentación de lo que hacen nuestras clases y funciones sin perder las mejores partes de Javascript.</p>
<p>Puedes encontrar el código en el siguiente repositorio de <a href="https://github.com/danieldisu/typescript-example" target="_blank" rel="external">Github</a></p>

      </p>

    </section>
  </article>
  </div>
  
  <nav class="pagination" role="pagination">
    <a class="newer-posts" href="/archives/2015/page/4/">← Newer Posts</a>
    <span class="page-number">Page 5 of 5</span>
    
  </nav>
</main>


  
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">danieldisu.com</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script>
$(document).ready(function() {
	$('pre code').each(function(i, block) {
		hljs.highlightBlock(block);
	});
});
</script>




<script type="text/javascript">
function UpdateTableHeaders() {
   $(".post-container").each(function() {

       var el             = $(this),
           offset         = el.offset(),
           scrollTop      = $(window).scrollTop(),
           floatingHeader = $(".floatingHeader", this)

       if ((scrollTop > offset.top) && (scrollTop < offset.top + (el.height() - 100))) {
           floatingHeader.css({
            "visibility": "visible",
						"width": window.innerHeight
           });
       } else {
           floatingHeader.css({
            "visibility": "hidden",
						"width": window.innerHeight
           });
       };
   });
}

// DOM Ready
$(function() {

   var clonedHeaderRow;

   $(".post-container").each(function() {
       clonedHeaderRow = $(".post-title", this);
       clonedHeaderRow
         .before(clonedHeaderRow.clone())
         .css("width", clonedHeaderRow.width())
         .addClass("floatingHeader");

   });

   $(window)
    .scroll(UpdateTableHeaders)
    .trigger("scroll");

});
</script>

</body>
</html>
